<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dyw.auth.db.mapper.SysRoleMapper">

    <resultMap id="BaseResultMap" type="cn.dyw.auth.db.domain.SysRole">
        <id property="roleCode" column="role_code"/>
        <result property="description" column="description"/>
        <result property="del" column="del"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <resultMap id="ParentRoleDto" type="cn.dyw.auth.db.model.ParentRoleDto" autoMapping="true">
        <id property="roleCode" column="descendant_role_code"/>
        <collection property="parentRoleCode" javaType="java.util.ArrayList" ofType="java.lang.String">
            <result column="ancestor_role_code"/>
        </collection>
    </resultMap>

    <select id="queryRoleList" resultType="cn.dyw.auth.db.model.RoleDto">
        select t1.role_code,
               t1.description,
               t1.role_name,
               t1.del,
               t1.create_time,
               t1.update_time,
               t2.ancestor_role_code as parent_role_code
        from sys_role t1
                 left join sys_role_hierarchy t2
                           on t1.role_code = t2.descendant_role_code
                               and t2.depth = 1
        where t1.del = false
    </select>

    <select id="queryRoleCodeByUser" resultType="java.lang.String">
        select distinct srh.descendant_role_code
        from sys_user_role sur
                 join sys_role_hierarchy srh
                      on sur.role_code = srh.ancestor_role_code
        where sur.username = #{username}
    </select>
    <select id="queryParentRoleList" resultMap="ParentRoleDto">
        select ancestor_role_code,
               descendant_role_code
        from sys_role_hierarchy
    </select>
    <select id="queryUserRoles" resultType="java.lang.String">
        select role_code
        from sys_user_role
        where username = #{username}
    </select>

</mapper>
